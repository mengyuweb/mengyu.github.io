var apiUrl="https://web.aijinseliunian.me/api/",map=new BMap.Map("container"),Public=function(){function t(){}var e=t.prototype;return e.fnMap=function(){map.centerAndZoom("无锡市",14),map.enableScrollWheelZoom(!0)},e.fnMapLine=function(t,e){var a=t.split(","),n=e.split(","),i=new BMap.Point(a[0],a[1]),s=new BMap.Point(n[0],n[1]),o=new BMap.DrivingRoute(map,{renderOptions:{map:map,autoViewport:!0},onPolylinesSet:function(t){for(var e=0;e<t.length;e++){var a=t[e].getPolyline();a.setStrokeColor("#01bc51"),a.setStrokeOpacity(.6)}},onMarkersSet:function(t){for(var e=0;e<t.length;e++)void 0===t[e].Km&&map.removeOverlay(t[e].marker)}});o.enableAutoViewport(),o.search(i,s)},e.fnSelect=function(t){for(var e in t)$(t[e]).select2({placeholder:"请选择",minimumResultsForSearch:-1})},e.$ajax=function(t,e,a){void 0===a&&(a="GET");var n=this;return new Promise(function(i,s){$.ajax({type:a,url:apiUrl+t,contentType:"application/json; charset=utf-8",dataType:"json",data:e,success:function(t){i(t)},error:function(t){n.fnAlert("服务器正在更新中...",3)}})})},e.fnTip=function(t){return'<div class="alert alert-dismissible fade show alertDui" role="alert">\n\t\t\t\t\t<div class="iconDui"><span class="iconfont icon-dui"></span></div>'+t+'\n\t\t\t\t\t<button type="button" class="close" data-dismiss="alert" aria-label="Close">\n\t\t\t\t\t\t<span aria-hidden="true">&times;</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>'},e.fnAlert=function(t,e){var a=Math.floor(50*Math.random()+1),n="alert alert-success alert-dismissable";switch(e){case 1:n="alert alert-info alert-dismissable";break;case 2:n="alert alert-warning alert-dismissable";break;case 3:n="alert alert-danger alert-dismissable"}var i='<div id="msg_id_'+a+'" class="alerts"><div class="'+n+'">'+t+"</div></div>";$("body").append(i);var s=$("#msg_id_"+a);setTimeout(function(){s.slideUp(300,function(){s.remove()})},2e3)},t}();define("public",function(){});var p=new Public,MapObj=function(){function t(){this.init(),this.objs={accidentRoad:"",accidenYear:""},this.solution=[]}var e=t.prototype;return e.init=function(){p.fnSelect(["#roadSection","#particularYear"]),p.fnMap(),this.fnAjaxInit(),this.fnClick()},e.fnAjaxInit=function(){var t=this;Promise.all([p.$ajax("getRoadlist"),p.$ajax("getYearlist")]).then(function(e){t.fnOption("#roadSection",e[0]),t.fnOption("#particularYear",e[1]),t.objs.accidentRoad=e[0][0].dictValue,t.objs.accidenYear=e[1][0].dictValue,t.fnMapMarker(1)})},e.fnMapMarker=function(t){Promise.all([p.$ajax("getAccidentlist",this.objs),p.$ajax("getRoadCoordinate",{accidentRoad:this.objs.accidentRoad})]).then(function(e){var a=e[1].coordinateStart,n=e[1].coordinateEnd;if(!(t||e[0].length||a||n))return p.fnAlert("暂无数据"),!1;var i=e[0];for(var s in i)if(i[s].accidentAddressLongitude&&i[s].accidentAddressLatitude){var o=new BMap.Marker(new BMap.Point(i[s].accidentAddressLongitude,i[s].accidentAddressLatitude));map.clearOverlays(),map.addOverlay(o)}a&&n&&p.fnMapLine(a,n)})},e.fnOption=function(t,e){var a="";for(var n in e)a+='<option value="'+e[n].dictValue+'">'+e[n].dictLabel+"</option>";$(t).html(a);var i=this.objs,s=this;$(t).on("change",function(){var e=$(this).select2("val");"#roadSection"==t?i.accidentRoad=e:i.accidenYear=e,s.fnMapMarker()})},e.fnClick=function(){var t=this;$("#topRightId li").click(function(){var e=$(this).data("id");"measures"==e?t.fnHtmls("measuresHtml","fnMeasures"):"hiddenDanger"==e?t.fnHtmls("hiddenDangerHtml","fnHiddenDanger"):"evaluate"==e&&t.fnHtmls("evaluateHtml","fnEvaluate")})},e.fnHtmls=function(t,e){var a=this;$("#"+t).text()?this[e]():htmlLoad({id:t,fn:function(){return a[e]()}})},e.fnHiddenDanger=function(){p.$ajax("getSecurityThreat",{accidentRoad:this.objs.accidentRoad}).then(function(t){var e="";for(var a in t)e+="<li><span>"+t[a].securityThreatId+"</span><span>"+t[a].securityThreat+"</span></li>";$("#hiddenDangerUi").html(e)}),$("#hiddenDanger").modal("show")},e.fnEvaluate=function(){p.$ajax("getImprovementEvaluation",{accidentRoad:this.objs.accidentRoad}).then(function(t){var e="";for(var a in t)e+='<tr class="heights">\n\t\t\t\t\t\t<th scope="row">'+t[a].kpiDisplay+"</th>\n\t\t\t\t\t\t<td>"+t[a].accidentNumberBefore+"</td>\n\t\t\t\t\t\t<td>"+t[a].accidentNumberAfter+"</td>\n\t\t\t\t\t\t<td>"+t[a].illegalNumberBefore+"</td>\n\t\t\t\t\t\t<td>"+t[a].illegalNumberAfter+"</td>\n\t\t\t\t\t\t<td>"+t[a].economicPerformanceBefore+"</td>\n\t\t\t\t\t\t<td>"+t[a].economicPerformanceAfter+"</td>\n\t\t\t\t\t\t<td>"+t[a].overallMeritBefore+"</td>\n\t\t\t\t\t\t<td>"+t[a].overallMeritAfter+"</td>\n\t\t\t\t\t</tr>";$("#tbodyTr").html(e)}),$("#evaluate").modal("show")},e.fnMeasures=function(){var t=this;this.measures||p.$ajax("getActionlist").then(function(e){e.length&&(t.fnMeasuresOptions(e,1),t.measures=e)}),$("#measures").modal("show")},e.fnMeasuresOptions=function(t,e){var a="";for(var n in t)a+=this.fnMeasuresDiv(t[n]);$("#leftMeasuresOptions").html(a),e&&($("#leftMeasuresLength").text(t.length),$("#moveTab").tooltip({selector:'[data-toggle="tooltip"]'}),this.fnMeasuresClick())},e.fnMeasuresDiv=function(t,e){return void 0===e&&(e="left"),'<div data-id="'+t.actionId+'" class="custom-checkbox '+("right"==e?"active":"")+'"><input type="checkbox" '+("right"==e?"checked":"")+' data-id="'+e+'" class="custom-control-input" id="'+t.actionId+'"><label class="custom-control-label" for="'+t.actionId+'" data-toggle="'+(t.actionName.length>10?"tooltip":"")+'"  title="'+t.actionName+'">'+t.actionName+"</label></div>"},e.fnMeasuresClick=function(){var t=this;$("#selectAll .selectDiv ul").off("click").click(function(){var e=$(this).data("index");if(t.selectUiIndex&&t.selectUiIndex!=e){if($(this).text()){var a=[];$(this).find("li").each(function(t,e){a.push($(e).data("id"))});var n=t.measures,i="",s="",o=0,r=0;for(var c in n)"-1"==a.indexOf(n[c].actionId)?(i+=t.fnMeasuresDiv(n[c]),o++):(s+=t.fnMeasuresDiv(n[c],"right"),r++);$("#leftMeasuresLength").text(o),$("#rightMeasuresIndex").text(r),$("#leftMeasuresOptions").html(i),$("#rightMeasuresOptions").html(s)}else t.fnMeasuresOptions(t.measures,1),$("#leftMeasuresIndex").text(0),$("#rightMeasuresOptions").empty(),$("#rightMeasures .iconSpan").removeClass("iconJian")}$("#moveTab .moveTabIndex").text(e),t.selectUiIndex=e,$("#moveTab").modal("show")}),$("#moveTabSubmit").off("click").click(function(){var e=$("#rightMeasuresOptions .active"),a="",n=[],i=t.solution;if(e.each(function(t,e){a+='<li data-id="'+$(e).data("id")+'">'+$(e).text()+"</li>",n.push($(e).data("id"))}),i.length){for(var s=-1,o=0;o<i.length;o++)if(i[o].solution==t.selectUiIndex){s=o;break}-1!=s?(i[s].solution=t.selectUiIndex,i[s].actionIds=n.toString()):i.push({solution:t.selectUiIndex,actionIds:n.toString()})}else i.push({solution:t.selectUiIndex,actionIds:n.toString()});$("#selectList"+t.selectUiIndex).html(a),$("#moveTab").modal("hide")}),$("#measuresSubmit").off("click").click(function(){p.$ajax("getSolutionScore",JSON.stringify(t.solution),"post").then(function(t){for(var e=t[0],a=1;a<t.length;a++)e.score<t[a].score&&(e=t[a]);$("#selectAll>div .optimal").empty(),$("#selectAll>div").eq(e.solution-1).find(".optimal").html('<div class="iconDui"><span class="iconfont icon-dui"></span></div>'),$("#optimalSolution").html(p.fnTip("已为你选出最优方案"+e.solution))})}),$("#measureBody").off("click").on("click",".list input",function(){var t=$(this).is(":checked"),e=$(this).data("id");t?$(this).parent().addClass("active"):$(this).parent().removeClass("active");var a=$("#"+e+"Measures .iconSpan"),n=$("#"+e+"MeasuresOptions .active").length;n?!a.hasClass("iconJian")&&a.addClass("iconJian"):a.removeClass("iconJian"),$("#"+e+"MeasuresIndex").text(n)}),$("#measureBody .tabBtn>div").off("click").click(function(){var t=$(this).data("id"),e="right"==t?"left":"right",a=$("#"+e+"MeasuresOptions .active");if(!a.length)return!1;var n="";a.each(function(a,i){var s=i.outerHTML.replace(new RegExp(e,""),t);n+=s.slice(0,71)+"checked='checked '"+s.slice(71)}),$("#"+t+"MeasuresOptions").prepend(n),a.remove();var i=$("#"+e+"MeasuresOptions .active").length,s=$("#"+t+"Measures .iconSpan");$("#"+t+"MeasuresIndex").text($("#"+t+"MeasuresOptions .active").length),$("#"+e+"MeasuresIndex").text(i),!s.hasClass("iconJian")&&s.addClass("iconJian"),!i&&$("#"+e+"Measures .iconSpan").removeClass("iconJian"),$("#leftMeasuresLength").text($("#leftMeasuresOptions>div").length)}),$("#measureBody .keyWord").bind("input propertychange",function(){var t=$(this).data("id"),e=$(this).val();if(null==e||""==e)$("#"+t+"MeasuresOptions .unSearch").removeClass("unSearch");else{var a=e;$("#"+t+"MeasuresOptions>div").removeClass("unSearch"),$("#"+t+"MeasuresOptions>div").each(function(){-1==$(this).find("label").html().indexOf(a)&&$(this).addClass("unSearch")})}})},t}();new MapObj,define("index",function(){}),require(["public","index"]),define("main",function(){});